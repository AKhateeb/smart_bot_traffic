<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Real Visit Generator</title>
        <link rel="stylesheet" href="/static/css/style.css">
        <link rel="stylesheet" href="/static/css/bootstrap.min.css">
        <link rel="stylesheet" href="/static/css/mdb.min.css">
        <link rel="stylesheet" href="/static/fonts/fontawesome-free/css/all.css">
        <link rel="stylesheet" href="/static/css/addons/animate.css">
        <link rel="stylesheet" href="/static/css/addons/iziToast.min.css">
        <link rel="stylesheet" href="/static/css/addons/modal-video.min.css">
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148361593-2"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'UA-148361593-2');
        </script>
        <!-- Default Statcounter code for Heroku Test
https://real-visit-generator.herokuapp.com/ -->
        <script type="text/javascript">
            var sc_project = 12174031;
            var sc_invisible = 0;
            var sc_security = "73fe7c87";
            var sc_https = 1;
            var scJsHost = "https://";
            document.write("<sc" + "ript type='text/javascript' src='" + scJsHost +
                "statcounter.com/counter/counter.js'></" + "script>");
        </script>
        <noscript>
            <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                        class="statcounter" src="https://c.statcounter.com/12174031/0/73fe7c87/0/" alt="Web
    Analytics"></a></div>
        </noscript>
        <!-- End of Statcounter Code -->

    </head>

    <body>
        <div class="container my-0 pt-0 px-2 z-depth-1" style="max-height: 200px; ">
            <div class="card card-image mb-4" id="ad-block-top"
                style="height: 200px; background-image:url(/static/ads-images/default.png); display: none;">
            </div>
        </div>

        <div class="container mt-1 pt-5 px-2 z-depth-1">

            <div class="text-center">
                <!--Section: Content-->
                <section class="text-center px-md-5 mx-md-5 dark-grey-text">
                    <h2>Welcome to you in our new</h2>
                    <h1 class="text-primary h1"> Real Visit Generator</h1>
                    <br>
                    <p>Kindly enter your desired pages and then click on start button</p>
                </section>
                <!--Section: Content-->
            </div>
            <hr>
            <!-- Material form row -->
            <form id="bot-form">
                <!-- Grid row -->
                <div class="form-row d-flex text-center">
                    <!-- Grid column -->
                    <div class="col-9">
                        <!-- Material input -->
                        <div class="md-form mt-0 ml-3 mr-1">
                            <input type="url" style="font-size: x-large;" autocomplete="off" autofocus
                                class="form-control" name="site_url" placeholder="Your URL Here">
                        </div>
                    </div>
                    <!-- Grid column -->

                    <!-- Grid column -->
                    <div class="col-3">
                        <!-- Material input -->
                        <div class="md-form mt-0">
                            <button type="submit" id="btn-start"
                                class="btn btn-x-large btn-primary waves-effect waves-light">
                                <i class="fas fa-rocket pr-3" aria-hidden="true"></i>Start</button>
                        </div>
                    </div>
                    <!-- Grid column -->
                </div>
                <!-- Grid row -->
            </form>
            <!-- Material form row -->

            <div class="container d-flex" style="min-height: 400px;" id="blocks-container">
                <div class="col-4 mb-1">
                    <!-- Card -->
                    <div class="card card-image mb-4" id="ad-block-left"
                        style="background-image:url(/static/ads-images/default.png); height: 300px; display: none;">
                    </div>
                    <!-- Card -->
                </div>
                <div class="col-4 mb-1">
                    <!-- Card -->
                    <div class="card card-cascade wider" style="display: none;" id="knob-container">
                        <!-- Card content -->
                        <div class="card-body card-body-cascade text-center">
                            <input type="text" class="dial" value="0">
                        </div>
                        <!-- Card content -->
                        <span class="text-primary text-center h2">Number of visits</span>
                    </div>
                    <!-- Card -->
                </div>
                <div class="col-4 mb-1">
                    <!-- Card -->
                    <div class="card card-image mb-4" id="ad-block-right"
                        style="background-image:url(/static/ads-images/default.png); height: 300px; display: none;">
                    </div>
                    <!-- Card -->
                </div>
            </div>
            <div class="container my-0 pt-0 px-2 z-depth-1" style="max-height: 200px; ">
                <div class="card card-image mb-4" id="ad-block-down"
                    style="height: 200px; background-image:url(/static/ads-images/default.png); display: none;">
                </div>
            </div>
            <div class="text-center">
                <span class="alert alert-success"> <span class="fa fa-info-circle pr-1"></span> If you want to make sure
                    that our automated visits are <b class="text-danger">NOT FAKE</b>, you can check server-logs at the
                    web-server of your input URL</span>
            </div>
            <div class="alert alert-primary py-2 px-4 mt-3" id="succeeded_ip_container" style="display: none;">
                <span class="fa fa-check-square pr-1"></span><b>Succeeded IPs:</b>
                <span class="succeeded_ip_text" style="word-break: break-all;"></span>
            </div>

            <div class="hidden" data-video-id="LcmS0y7ZOXI"></div>
        </div>
        </div>
        </div>

        <script src="/static/js/popper.min.js"></script>
        <script src="/static/js/jquery.min.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
        <script src="/static/js/mdb.min.js"></script>
        <script src="/static/js/addons/jquery.knob.js"></script>
        <script src="/static/js/addons/iziToast.min.js"></script>
        <script src="/static/js/addons/modal-video.min.js"></script>
        <script>
            const ADS_TIMER = 7000;
            const GET_VISITS_TIMER = 2800;
            const LIMIT = 50;

            poll_interval = null;
            ads_interval = null;
            ads_images_list = []

            new ModalVideo('div.hidden');


            // function init() {
            //     $("#knob-container").fadeOut(100);
            //     $("#ad-block-left").fadeOut(100);
            //     $("#ad-block-right").fadeOut(100);
            //     $("#btn-start").removeAttr('disabled');
            // }

            function update_knob(new_value) {
                $('.dial')
                    .val(new_value)
                    .trigger('change');
            }

            function reset_and_show_ads() {

                // $("#btn-start").removeAttr('disabled');
                $("#ad-block-left").slideDown(400);
                $("#ad-block-right").slideDown(400);
                $("#ad-block-top").slideDown(400);
                $("#ad-block-down").slideDown(400);

                // clearInterval(poll_interval);

                ads_interval = setInterval(() => {
                    var rand_ad_1 = Math.floor(Math.random() * ads_images_list.length)
                    var rand_ad_2 = Math.floor(Math.random() * ads_images_list.length)

                    if (rand_ad_2 == rand_ad_1) {
                        rand_ad_2 = Math.min(rand_ad_2 - 1, ads_images_list.length - 1)
                    }

                    console.log(ads_images_list[rand_ad_1]);

                    $("#ad-block-right")
                        .animate({
                            opacity: 0
                        }, 'slow', function () {
                            $(this)
                                .css({
                                    'background-image': `url(${ads_images_list[rand_ad_1]})`
                                })
                                .animate({
                                    opacity: 1
                                });
                        });
                    $("#ad-block-left")
                        .animate({
                            opacity: 0
                        }, 'slow', function () {
                            $(this)
                                .css({
                                    'background-image': `url(${ads_images_list[rand_ad_2]})`
                                })
                                .animate({
                                    opacity: 1
                                });
                        });
                    $("#ad-block-top")
                        .animate({
                            opacity: 0
                        }, 'slow', function () {
                            $(this)
                                .css({
                                    'background-image': `url(${ads_images_list[rand_ad_2]})`
                                })
                                .animate({
                                    opacity: 1
                                });
                        });
                    $("#ad-block-down")
                        .animate({
                            opacity: 0
                        }, 'slow', function () {
                            $(this)
                                .css({
                                    'background-image': `url(${ads_images_list[rand_ad_1]})`
                                })
                                .animate({
                                    opacity: 1
                                });
                        });
                }, ADS_TIMER);
            }

            let ads_shown = false

            function update_counter() {
                $.get("/get_visits", {},
                    function (response, textStatus, jqXHR) {
                        // console.log(success_ips);
                        if (!typeof response.succeeded_ips == "object") return
                        let value = response.n_succeeded;
                        if (value < $(".dial").val()) return

                        $("#succeeded_ip_container > .succeeded_ip_text").html(
                            response.succeeded_ips.join('<b class="text-danger px-2">|</b>'));

                        update_knob(value);

                        if (value >= LIMIT && !ads_shown) {
                            ads_shown = true;
                            reset_and_show_ads();
                            iziToast.success({
                                title: value + " Visits",
                                message: "are successfully done"
                            });
                            iziToast.info({
                                title: `${ads_images_list.length} Ads`,
                                message: `found in the pre-defined folder`,
                                timeout: 8000
                            })
                            update_knob(value);
                            setTimeout(() => {
                                $("div.hidden").trigger('click');

                            }, 2000);
                        }
                    },
                    "json"
                );
            }

            $(document).ready(function () {
                $("#btn-start").click(function (e) {
                    e.preventDefault();

                    $.ajax({
                        type: "GET",
                        url: "/start_bot",
                        data: {
                            url: $("input[name=site_url]").val().trim()
                        },
                        dataType: "JSON",
                        beforeSend: function (param) {
                            $("#blocks-container").show(500);
                            clearInterval(ads_interval);
                            $("#ad-block-left").slideUp(400);
                            $("#ad-block-right").slideUp(400);
                            $("#ad-block-top").slideUp(400);
                            $("#ad-block-down").slideUp(400);
                            $("#btn-start").attr('disabled', "");
                            $("input[name=site_url]").attr('disabled', "");
                        },
                        success: function (response, status_text, xhr) {
                            if (xhr.status != 200) return

                            iziToast.info({
                                title: `${response.n_workers} Workers`,
                                message: `have been launched to visit url`,
                                timeout: 5000
                            })

                            ads_images_list = response.ads_list.map(e =>
                                "/static/ads-images/" + e);

                            $(".dial").knob({
                                'change': function (v) {
                                    console.log(v);
                                },
                                "value": 0,
                                "min": 0,
                                "max": LIMIT,
                                "fgColor": "#007BFF",
                                "skin": "tron",
                                "cursor": false,
                                // width: "90%",
                                // height: "90%",
                                rotation: "anticlockwise",
                                angleOffset: -125,
                                angleArc: 250,
                                readOnly: true
                            });
                            $("#knob-container").slideDown(400);
                            $("input[name=site_url]").removeClass('is-invalid').addClass(
                                "is-valid");
                            $("#succeeded_ip_container").slideDown(400);


                            poll_interval = setInterval(() => {
                                update_counter();
                            }, GET_VISITS_TIMER);
                        },
                        error: function (error) {
                            console.warn(error.responseText);
                            if (error.responseText == "Invalid URL") {
                                $("#btn-start").removeAttr('disabled');
                                $("input[name=site_url]").removeAttr('disabled');
                                $("input[name=site_url]").removeClass('is-valid').addClass(
                                    "is-invalid");
                                iziToast.error({
                                    title: "Invalid URL",
                                    message: $("input[name=site_url]").val().trim(),
                                    timeout: 4500
                                });
                                $("input[name=site_url]").focus();
                            }
                        }
                    });
                });


            });
        </script>
    </body>

</html>